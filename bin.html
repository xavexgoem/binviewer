<!-- TODO

* RGB materials aren't handled
* Probably refactor the UI stuff out of setupThree

-->

<!DOCTYPE html>
<head>
<title>LGMD BIN viewer</title>
<script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three/build/three.module.js",
      "three/addons/": "https://unpkg.com/three/examples/jsm/",
      "jszip": "https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"
		}
	}
</script>
<script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
	* { 
		font-family: monospace; 
		font-weight: bold; 
		color: #111; 
	}
	.main-flex { 
		display: flex; 
		flex-direction: row; 
		align-items: flex-start; 
		justify-content: space-between;
	}
	.contain { 
		width: 33%; 
		min-width: 340px; 
		max-width: 33%;
	}
	table { 
		width: 100%; 
		min-width: 340px; 
		border-collapse: collapse; 
	}
	th { 
		background-color: #444; 
		color: #fff; 
		font-size: 110%; 
	}
	td { 
		margin: 0; 
		padding: 0; 
	}
	tr:nth-child(odd) { 
		background-color: #eee; 
	}
	.sep { 
		border-bottom: 2px solid #999;
	}
	.viewer { 
		display: flex;
		flex-direction: column;
		flex-grow: 1;
		min-width: 340px;
		align-items: stretch;
	}

	#viewer {
		flex-grow: 2;
		min-height: 480px; 
		display: flex;
		justify-content: center;
		align-items: center;
	}
	#viewer-control { 
		text-align: center; 
		width: 33%;
	}
</style>
</head>
<body>
<div>
	<label for="binInput">Select .bin file:</label>
	<input type="file" id="input" accept=".bin">
	<label for="textureInput">Select texture images (pcx not supported):</label>
	<input type="file" id="textureInput" multiple accept="image/*">
	<label for="textureDirectoryInput">Or upload entire texture directory:</label>
	<input type="file" id="textureDirectoryInput" webkitdirectory directory multiple accept="image/*">
	<label for="zipInput">Or upload zip file (bin in root, textures in txt/txt16/):</label>
	<input type="file" id="zipInput" accept=".zip">
	<label for="zipDirectoryInput">Or upload entire directory of zip files:</label>
	<input type="file" id="zipDirectoryInput" webkitdirectory directory multiple accept=".zip">
</div>

<div class="main-flex">
	<div class="viewer">
		<div style="text-align:center; margin-top:8px;" id="viewer"></div>
		<div id="viewer-control" style="text-align: left;">
			<label><input type="checkbox" id="toggle-bbox" checked> Show bounding box</label><br>
			<label><input type="checkbox" id="toggle-vhots" checked> Show vhots</label>
		</div>
	</div>
</div>
</div>


<script type="module">
  import * as App from './app.js';
  import * as MultiModel from './multiModelViewer.js';

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('input')?.addEventListener('change', App.handleFileInput);
    document.getElementById('textureInput')?.addEventListener('change', App.handleTextureInput);
    document.getElementById('textureDirectoryInput')?.addEventListener('change', App.handleDirectoryInput);
    document.getElementById('zipInput')?.addEventListener('change', App.handleZipInput);
    document.getElementById('zipDirectoryInput')?.addEventListener('change', MultiModel.handleZipDirectoryInput);
    window.addEventListener('resize', App.handleResize);

    // Make App globally available for the multi-model module
    window.App = App;
  });
  </script>
</body>
</html>
